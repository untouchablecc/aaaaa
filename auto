---- Ensure the tool the player is holding is properly retrieved
local function getHeldTool()
    local character = game.Players.LocalPlayer.Character
    if character then
        for _, tool in pairs(character:GetChildren()) do
            if tool:IsA("Tool") then
                return tool
            end
        end
    end
    return nil
end

-- AutoShoot toggle logic with notification and delayed tool activation
game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == AutoShoot.Key then
        AutoShoot.Enabled = not AutoShoot.Enabled
        
        -- Notification when toggling
        if AutoShoot.NOTIF then
            local status = AutoShoot.Enabled and "Enabled" or "Disabled"
            game.StarterGui:SetCore("SendNotification", {
                Title = "Auto Shoot",
                Text = status,
                Duration = 2,
            })
        end
    end
end)

-- Main AutoShoot logic with tool activation and precise delay
task.spawn(function()
    while true do
        task.wait(0.1)  -- Main loop to prevent overload

        if AutoShoot.Enabled then
            local Tool = getHeldTool()  -- Check the currently held tool

            if Tool and Tool:FindFirstChild("Handle") then  -- Make sure tool has a handle or necessary parts
                Tool:Activate()  -- Activate the tool (shoots)
                task.wait(AutoShoot.Delay)  -- Precise delay between shots (using task.wait for better timing)
            end
        end
    end
end)
